<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Expense Tracker</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="settings-styles.css">
</head>
<body>
    <div id="app">
        <div class="main-screen">
            <header>
                <div class="header-content">
                    <h1>‚öôÔ∏è Settings</h1>
                    <button class="btn btn-secondary" onclick="window.location.href='index.html'">Back to Dashboard</button>
                </div>
            </header>

            <main class="settings-container">
                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab-btn active" data-tab="account">
                        <span class="tab-icon">üë§</span>
                        <span class="tab-label">Account</span>
                    </button>
                    <button class="settings-tab-btn" data-tab="aws">
                        <span class="tab-icon">‚òÅÔ∏è</span>
                        <span class="tab-label">AWS Integration</span>
                    </button>
                </div>

                <!-- Account Tab -->
                <div id="account-tab" class="settings-tab-content active">
                    <div class="settings-card">
                        <h2>Account Information</h2>
                        <div class="info-row">
                            <span class="label">Email:</span>
                            <span id="user-email" class="value">Loading...</span>
                        </div>
                        <div class="info-row">
                            <span class="label">User ID:</span>
                            <span id="user-id" class="value">Loading...</span>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h2>Linked Accounts</h2>
                        <p class="description">Link your Google account to sign in with either email/password or Google.</p>
                        
                        <div id="google-link-status" class="link-status">
                            <div class="status-row">
                                <div class="status-info">
                                    <svg class="status-icon" id="google-status-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    <div>
                                        <div class="status-title" id="google-status-title">Google Account</div>
                                        <div class="status-subtitle" id="google-status-subtitle">Not linked</div>
                                    </div>
                                </div>
                                <button class="btn btn-google" id="link-google-btn" onclick="linkGoogleAccount()">
                                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                                    </svg>
                                    Link Google Account
                                </button>
                            </div>
                        </div>

                        <div id="link-message" class="message"></div>

                        <div class="info-box">
                            <h4>‚ÑπÔ∏è About Account Linking</h4>
                            <ul>
                                <li>Link your Google account to sign in with either method</li>
                                <li>Your data remains the same regardless of sign-in method</li>
                                <li>You can unlink accounts at any time</li>
                                <li>Both accounts must use the same verified email address</li>
                            </ul>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h2>Sign Out</h2>
                        <p class="description">Sign out of your account on this device.</p>
                        <button class="btn btn-danger" onclick="signOut()">Sign Out</button>
                    </div>
                </div>

                <!-- AWS Integration Tab -->
                <div id="aws-tab" class="settings-tab-content">
                    <div class="settings-card">
                        <h2>AWS Cost Tracking</h2>
                        <p class="description">Connect your AWS account to automatically import monthly cost data as expenses.</p>
                        
                        <div id="aws-credentials-status" class="credential-status">
                            <!-- Status will be loaded here -->
                        </div>
                        
                        <div id="aws-credentials-form" class="credentials-form" style="display: none;">
                            <div class="form-group">
                                <label for="aws-access-key">AWS Access Key ID *</label>
                                <input type="text" id="aws-access-key" placeholder="AKIA..." required>
                                <small>Your AWS IAM access key with Cost Explorer read permissions</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="aws-secret-key">AWS Secret Access Key *</label>
                                <input type="password" id="aws-secret-key" placeholder="Enter secret key" required>
                                <small>This will be encrypted and stored securely</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="aws-region">AWS Region</label>
                                <select id="aws-region">
                                    <optgroup label="North America">
                                        <option value="us-east-1">US East (N. Virginia)</option>
                                        <option value="us-east-2">US East (Ohio)</option>
                                        <option value="us-west-1">US West (N. California)</option>
                                        <option value="us-west-2">US West (Oregon)</option>
                                        <option value="ca-central-1">Canada (Central)</option>
                                        <option value="ca-west-1">Canada West (Calgary)</option>
                                        <option value="us-gov-east-1">AWS GovCloud (US-East)</option>
                                        <option value="us-gov-west-1">AWS GovCloud (US-West)</option>
                                    </optgroup>
                                    <optgroup label="South America">
                                        <option value="sa-east-1">South America (S√£o Paulo)</option>
                                    </optgroup>
                                    <optgroup label="Europe">
                                        <option value="eu-central-1">Europe (Frankfurt)</option>
                                        <option value="eu-west-1">Europe (Ireland)</option>
                                        <option value="eu-west-2">Europe (London)</option>
                                        <option value="eu-west-3">Europe (Paris)</option>
                                        <option value="eu-south-1">Europe (Milan)</option>
                                        <option value="eu-north-1">Europe (Stockholm)</option>
                                        <option value="eu-south-2">Europe (Spain)</option>
                                        <option value="eu-central-2">Europe (Zurich)</option>
                                    </optgroup>
                                    <optgroup label="Middle East">
                                        <option value="me-south-1">Middle East (Bahrain)</option>
                                        <option value="me-central-1">Middle East (UAE)</option>
                                        <option value="il-central-1">Middle East (Tel Aviv)</option>
                                    </optgroup>
                                    <optgroup label="Africa">
                                        <option value="af-south-1">Africa (Cape Town)</option>
                                    </optgroup>
                                    <optgroup label="Asia Pacific">
                                        <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
                                        <option value="ap-northeast-2">Asia Pacific (Seoul)</option>
                                        <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                                        <option value="ap-southeast-2">Asia Pacific (Sydney)</option>
                                        <option value="ap-south-1">Asia Pacific (Mumbai)</option>
                                        <option value="ap-northeast-3">Asia Pacific (Osaka)</option>
                                        <option value="ap-east-1">Asia Pacific (Hong Kong)</option>
                                        <option value="ap-southeast-3">Asia Pacific (Jakarta)</option>
                                        <option value="ap-southeast-4">Asia Pacific (Melbourne)</option>
                                        <option value="ap-south-2">Asia Pacific (Hyderabad)</option>
                                        <option value="ap-southeast-5">Asia Pacific (Malaysia)</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-group" id="iam-arn-display" style="display: none;">
                                <label>IAM User ARN</label>
                                <div class="arn-display">
                                    <code id="iam-arn-value"></code>
                                    <button type="button" id="copy-arn" class="btn-copy" title="Copy ARN">üìã</button>
                                </div>
                                <small>This is your IAM user's Amazon Resource Name</small>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="save-aws-credentials" class="btn btn-primary">Save Credentials</button>
                                <button type="button" id="cancel-aws-credentials" class="btn btn-secondary">Cancel</button>
                            </div>
                            
                            <div class="error-message" id="aws-credentials-error"></div>
                            <div class="success-message" id="aws-credentials-success"></div>
                        </div>
                        
                        <div class="info-box setup-instructions">
                            <h4>üìã Step-by-Step: Create an IAM User for Cost Tracking</h4>
                            <ol class="setup-steps">
                                <li>
                                    <strong>Open AWS IAM Console</strong>
                                    <p>Go to <a href="https://console.aws.amazon.com/iam/" target="_blank">AWS IAM Console</a> and sign in to your AWS account.</p>
                                </li>
                                <li>
                                    <strong>Create a New IAM User</strong>
                                    <p>Click "Users" in the left sidebar, then click "Create user".</p>
                                    <p>Enter a username like <code>expense-tracker-cost-reader</code>.</p>
                                </li>
                                <li>
                                    <strong>Set Permissions</strong>
                                    <p>Select "Attach policies directly" and click "Create policy".</p>
                                    <p>In the JSON tab, paste this policy:</p>
                                    <pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ce:GetCostAndUsage",
        "ce:GetCostForecast"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
                                    <p>Name it <code>CostExplorerReadOnly</code> and create the policy.</p>
                                </li>
                                <li>
                                    <strong>Attach the Policy</strong>
                                    <p>Go back to user creation, refresh policies, and attach <code>CostExplorerReadOnly</code>.</p>
                                </li>
                                <li>
                                    <strong>Create Access Keys</strong>
                                    <p>After creating the user, click on the user name, go to "Security credentials" tab.</p>
                                    <p>Click "Create access key", select "Application running outside AWS", and click "Create".</p>
                                </li>
                                <li>
                                    <strong>Save Your Credentials</strong>
                                    <p>Copy the <strong>Access Key ID</strong> and <strong>Secret Access Key</strong>.</p>
                                    <p class="warning-text">‚ö†Ô∏è This is the only time you'll see the secret key! Save it securely.</p>
                                </li>
                                <li>
                                    <strong>Enter Credentials Above</strong>
                                    <p>Paste your Access Key ID and Secret Access Key in the form above and click "Save Credentials".</p>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="info-box">
                            <h4>üîí Security & Privacy</h4>
                            <ul>
                                <li>Your Secret Access Key is encrypted using AES-256-GCM before storage</li>
                                <li>The IAM user only has read-only access to cost data</li>
                                <li>No other AWS resources can be accessed with these credentials</li>
                                <li>You can revoke access anytime by deleting the IAM user in AWS</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="settings.js"></script>
</body>
</html>
