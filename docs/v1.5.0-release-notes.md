# Version 1.5.0 Release Notes

**Release Date:** November 7, 2025

## Overview

Version 1.5.0 introduces Google OAuth authentication, allowing users to sign in with their Google account in addition to the existing email/password method. This enhancement provides a more convenient authentication experience and reduces friction for new users.

## New Features

### Google OAuth Sign-In

Users can now authenticate using their Google account through AWS Cognito's federated identity provider integration.

**Benefits:**
- **Faster Onboarding:** New users can sign up with a single click
- **No Password Management:** Users don't need to remember another password
- **Secure Authentication:** Leverages Google's robust authentication infrastructure
- **Seamless Experience:** Both authentication methods lead to the same application features

**How It Works:**
1. User clicks "Sign in with Google" button on login page
2. Redirected to Cognito Hosted UI
3. Redirected to Google for authentication
4. User authorizes the application
5. Redirected back to application with authentication tokens
6. User is logged in and can access all features

## Changes

### Authentication System

- **Multiple Sign-In Methods:** Users can choose between email/password or Google OAuth
- **Enhanced Session Management:** Supports both Cognito and OAuth token management
- **Improved Logout:** Handles sign-out for both authentication methods appropriately

### User Interface

- **"Sign in with Google" Button:** Added to login page with official Google branding
- **Auth Divider:** Visual separator between authentication methods
- **Responsive Design:** Google button works seamlessly on mobile and desktop

## Technical Implementation

### Frontend Components

**New Files:**
- `frontend/oauth.js` - OAuth authentication module
  - `signInWithGoogle()` - Initiates OAuth flow
  - `handleOAuthCallback()` - Processes authorization code
  - `refreshAccessToken()` - Handles token refresh
  - `signOut()` - OAuth-aware logout
  - `parseJwt()` - JWT token parsing utility

**Modified Files:**
- `frontend/app.js`
  - Added OAuth configuration (domain, redirect URIs)
  - Updated initialization to check for OAuth callbacks
  - Enhanced authentication checking to support both methods
  - Modified logout to use OAuth-aware function

- `frontend/index.html`
  - Added Google sign-in button with SVG logo
  - Added auth divider ("OR" separator)
  - Included oauth.js script

- `frontend/styles.css`
  - Google button styling following Google's brand guidelines
  - Auth divider styling
  - Hover and active states for Google button

### AWS Configuration

**Cognito User Pool:**
- Domain configured: `expense-tracker-prod.auth.us-east-1.amazoncognito.com`
- Google added as identity provider
- App client OAuth settings configured:
  - Callback URL: `https://app.twin-wicks.com/callback`
  - Sign-out URL: `https://app.twin-wicks.com`
  - OAuth flows: Authorization code grant
  - Scopes: openid, email, profile, aws.cognito.signin.user.admin

**Google Cloud Console:**
- OAuth 2.0 credentials created
- OAuth consent screen configured
- Authorized redirect URIs set
- Scopes: email, profile, openid

### Security Considerations

- **Authorization Code Grant:** Most secure OAuth 2.0 flow
- **HTTPS Only:** All OAuth redirects use secure connections
- **Token Storage:** Tokens stored in localStorage with appropriate security measures
- **Scope Limitation:** Only requests necessary user information
- **State Parameter:** CSRF protection (to be implemented in future update)

## Known Limitations

### Account Linking Not Yet Implemented

Currently, if a user signs up with email/password and later tries to sign in with Google using the same email address, they will be treated as separate accounts. 

**Planned Solution:**
A Pre-Authentication Lambda trigger will be implemented in a future update to automatically link accounts based on email address. This will provide a seamless experience for users who want to switch between authentication methods.

**Workaround:**
Users should consistently use the same sign-in method they originally chose.

## Deployment

### Frontend Deployment
```bash
cd frontend
aws s3 cp index.html s3://expense-tracker-frontend-391907191624/
aws s3 cp app.js s3://expense-tracker-frontend-391907191624/
aws s3 cp oauth.js s3://expense-tracker-frontend-391907191624/
aws s3 cp styles.css s3://expense-tracker-frontend-391907191624/

aws cloudfront create-invalidation \
  --distribution-id EB9MXBNYV9HVD \
  --paths "/index.html" "/app.js" "/oauth.js" "/styles.css"
```

### Manual Configuration Steps

The following steps were completed manually in AWS Console and Google Cloud Console:

1. **Cognito Domain Configuration**
   - Configured domain prefix: `expense-tracker-prod`

2. **Google OAuth Credentials**
   - Created OAuth 2.0 client ID
   - Configured OAuth consent screen
   - Set authorized redirect URIs

3. **Cognito Identity Provider**
   - Added Google as identity provider
   - Configured client ID and secret
   - Set attribute mappings

4. **App Client OAuth Settings**
   - Enabled Google identity provider
   - Configured callback and sign-out URLs
   - Enabled OAuth flows and scopes

## Testing

### Test Scenarios

✅ **New User Sign-Up with Google**
- Click "Sign in with Google"
- Authorize with Google account
- Successfully redirected to dashboard

✅ **Existing User Sign-In with Google**
- Click "Sign in with Google"
- Authorize with Google account
- Successfully redirected to dashboard

✅ **Email/Password Still Works**
- Existing email/password authentication unaffected
- Users can still sign up and log in with email/password

✅ **Logout Functionality**
- Google users properly signed out from Cognito
- Redirected to Cognito logout page
- Then redirected back to application

✅ **Token Management**
- Tokens stored correctly in localStorage
- Session persists across page refreshes
- API requests include proper authorization headers

### Browser Compatibility

Tested and working on:
- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)
- Mobile browsers (iOS Safari, Chrome Mobile)

## Upgrade Notes

This is a minor version release with new features. No breaking changes.

**For Existing Users:**
- Email/password authentication continues to work exactly as before
- No action required from existing users
- Users can optionally start using Google sign-in if they prefer

**For New Users:**
- Can choose either email/password or Google sign-in
- Both methods provide full access to all features

## Future Enhancements

### Planned for v1.5.1 or v1.6.0

1. **Account Linking**
   - Pre-Authentication Lambda trigger
   - Automatic linking of accounts with matching emails
   - Seamless switching between authentication methods

2. **Additional OAuth Providers**
   - Microsoft/Azure AD
   - Apple Sign In
   - GitHub

3. **Enhanced Security**
   - PKCE (Proof Key for Code Exchange)
   - State parameter for CSRF protection
   - Nonce parameter for replay attack prevention

4. **User Profile Enhancements**
   - Display Google profile picture
   - Show authentication method in user settings
   - Allow users to link/unlink authentication methods

## Documentation

### Updated Documentation
- `docs/GOOGLE-OAUTH-SETUP-GUIDE.md` - Complete setup instructions
- `docs/GOOGLE-OAUTH-QUICK-REFERENCE.md` - Quick reference card
- `docs/v1.5.0-google-oauth-plan.md` - Implementation plan
- `CHANGELOG.md` - Updated with v1.5.0 changes

### Configuration Files
- `docs/google-oauth-config.md` - OAuth configuration (not in git)
- `.gitignore` - Updated to exclude sensitive config files

## Support

For issues or questions about Google OAuth authentication:
1. Check the setup guide: `docs/GOOGLE-OAUTH-SETUP-GUIDE.md`
2. Review known limitations above
3. Submit feedback at https://help.manus.im

## Contributors

- Manus AI Agent - Google OAuth implementation
- User - AWS and Google Cloud Console configuration

## Version History

- **1.5.0** (2025-11-07) - Google OAuth sign-in
- **1.3.1** (2025-11-06) - CORS fix and logo links
- **1.3.0** (2025-11-06) - Enhanced dashboard
- **1.2.4** (2025-11-05) - AWS cost import fixes

